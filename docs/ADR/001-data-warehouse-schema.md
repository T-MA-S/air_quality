# ADR-001: Выбор схемы витрины данных

## Статус
Принято

## Контекст
Необходимо выбрать схему хранения данных для витрины, которая будет содержать данные о качестве воздуха и погоде из множества городов. Данные поступают из разных источников (OpenAQ, Open-Meteo) с разной структурой и частотой обновления.

## Варианты решения

### Вариант 1: Нормализованная схема (3NF)
- Все данные в одной таблице с нормализацией
- Минимум дублирования данных
- Сложные JOIN для аналитических запросов

### Вариант 2: Денормализованная схема (Flat)
- Все данные в одной широкой таблице
- Простые запросы
- Дублирование данных, сложность обновления

### Вариант 3: Схема "звезда" (Star Schema) ✅
- Факт-таблицы (fact_air_quality, fact_weather)
- Справочники (dim_city, dim_metric)
- Оптимизация для аналитики
- Баланс между нормализацией и производительностью

## Решение
Выбрана схема "звезда" (Star Schema).

## Обоснование

1. **Производительность аналитических запросов**: Схема "звезда" оптимизирована для OLAP запросов, которые преобладают в дашборде.

2. **Масштабируемость**: Легко добавлять новые города (dim_city) и метрики (dim_metric) без изменения структуры факт-таблиц.

3. **Разделение данных**: Воздух и погода в отдельных факт-таблицах, что соответствует их разным источникам и частоте обновления.

4. **Гибкость**: Представления (views) позволяют создавать различные комбинации данных для разных аналитических задач.

5. **Стандартная практика**: Схема "звезда" - стандарт для витрин данных в аналитических системах.

## Последствия

### Положительные
- Эффективные запросы для дашборда
- Легкое добавление новых измерений
- Четкое разделение справочников и фактов

### Отрицательные
- Необходимость поддержки нескольких таблиц
- JOIN при объединении данных (решается представлениями)

## Альтернативы, которые были рассмотрены

- **Снежинка (Snowflake Schema)**: Более нормализованная версия, но избыточна для наших данных
- **Data Vault**: Слишком сложно для текущих требований

## Дата принятия
2024-01-01

