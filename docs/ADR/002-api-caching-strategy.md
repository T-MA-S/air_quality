# ADR-002: Стратегия кэширования API ответов

## Статус
Принято

## Контекст
API источники (OpenAQ, Open-Meteo) имеют rate limits и могут быть медленными. Необходимо минимизировать количество запросов и ускорить разработку/тестирование.

## Варианты решения

### Вариант 1: Без кэширования
- Всегда запрашивать данные из API
- Максимальная актуальность данных
- Высокая нагрузка на API, медленная разработка

### Вариант 2: In-memory кэш (TTLCache)
- Быстрый доступ
- Ограничен объемом памяти
- Данные теряются при перезапуске

### Вариант 3: Файловый кэш
- Персистентность между запусками
- Медленнее чем память
- Занимает место на диске

### Вариант 4: Гибридный подход ✅
- In-memory для частых запросов
- Файловый для персистентности
- TTL для обоих уровней

## Решение
Реализован гибридный подход с двухуровневым кэшированием.

## Обоснование

1. **Персистентность**: Файловый кэш сохраняет данные между запусками, что критично для разработки и тестирования.

2. **Производительность**: In-memory кэш обеспечивает быстрый доступ к часто используемым данным.

3. **Снижение нагрузки**: Кэширование снижает количество запросов к API, что важно для соблюдения rate limits.

4. **Гибкость**: TTL позволяет балансировать между актуальностью и производительностью.

## Реализация

- **Файловый кэш**: `FileCache` с pickle сериализацией, TTL = 1 час
- **In-memory кэш**: `MemoryCache` на основе TTLCache, TTL = 1 час
- Ключ кэша: MD5 хэш от endpoint + параметров запроса

## Последствия

### Положительные
- Снижение нагрузки на API
- Ускорение разработки
- Персистентность данных

### Отрицательные
- Возможная устарелость данных (решается TTL)
- Занимаемое место на диске (незначительно)
- Необходимость управления кэшем

## Альтернативы, которые были рассмотрены

- **Redis**: Избыточно для текущих требований, требует дополнительной инфраструктуры
- **База данных**: Медленнее чем файловый кэш для простых запросов

## Дата принятия
2024-01-01

